<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitación Cielo y José</title>
    </head>
<body>

<div id="contenedor-sobre">
    <div class="sobre-visual" id="btnAbrirSobre">
        <div class="sello-laca"><span>C&J</span></div>
        <p style="margin-top:20px; letter-spacing: 2px; color: #b08d57;">TOCA PARA ABRIR</p>
    </div>
</div>

<audio id="miMusica" loop preload="auto">
    <source src="musica.mp3" type="audio/mpeg">
</audio>

<div id="btnMusica" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; background: white; width: 45px; height: 45px; border-radius: 50%; display: none; justify-content: center; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: 2px solid #b08d57; cursor: pointer;">
    <span id="estadoIcono">⏸</span>
</div>

<script>
    const audio = document.getElementById("miMusica");
    const btnAbrir = document.getElementById("btnAbrirSobre");
    const contenedor = document.getElementById("contenedor-sobre");
    const btnControl = document.getElementById("btnMusica");
    const icono = document.getElementById("estadoIcono");

    // Función principal basada en las "Best Practices" del texto que pasaste
    btnAbrir.addEventListener("click", function() {
        // 1. Efecto visual
        contenedor.style.transform = "translateY(-100%)";
        contenedor.style.opacity = "0";
        setTimeout(() => { contenedor.style.display = "none"; }, 1000);
        
        // 2. Mostrar control de música
        btnControl.style.display = "flex";

        /** * LÓGICA DE AUDIO REFORZADA:
         * El artículo dice que play() devuelve una Promesa. 
         * La usamos para manejar el error si el navegador bloquea el audio.
         **/
        audio.play().then(() => {
            console.log("Autoplay exitoso tras interacción");
        }).catch(error => {
            console.log("El navegador bloqueó el audio. Reintentando...");
            // Si falla, lo intentamos una vez más con un 'switch' de mute
            audio.muted = true;
            audio.play().then(() => {
                audio.muted = false; // Lo activamos apenas arranca
            });
        });
    });

    // Control manual por si el usuario quiere silenciar
    btnControl.addEventListener("click", function() {
        if (audio.paused) {
            audio.play();
            icono.innerText = "⏸";
        } else {
            audio.pause();
            icono.innerText = "▶";
        }
    });
</script>

</body>
</html>
